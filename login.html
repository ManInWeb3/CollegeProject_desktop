<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Writing test application.</title>

    <link rel="stylesheet" href="./css/jquery-ui.min.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/styles.css">

    <script>window.$ = window.jQuery = require('jquery');</script>
    <script src="./js/jquery-ui.min.js"></script>
</head>
<body>
    <script>
        const APISRV='http://exam.expert-it.org:81/api/v1/';
        const {ipcRenderer} = require('electron');
        var checkPIN = function() {
                            var request = require('request');
                            let pin_code = $('input[name="pin_code"]').val();
                            request.get(APISRV+'test/'+pin_code+'/').on('response', function(response) {
                                console.log("OK:"+pin_code+" code"+response.statusCode);
                                if(response.statusCode == 200) {
                                    ipcRenderer.send('loginOK', pin_code);
                                } else if(response.statusCode == 404) {
                                    $('#msg').html('Wrong PIN code').attr('class', "alert alert-warning" )
                                }
                                $('input[name="pin_code"]').val('');
                            });
                        }

        $('<div>Please enter PIN code:<div id="msg"></div><input type="text" style="z-index:10000" name="pin_code"></div>').dialog({
            modal: true,
            width: 350,
            position: { my: "center", at: "center", of: window },
            title: "Please enter PIN code to access your test.",
            open: function() {
               $(this).keydown(function (event) {
                    if (event.keyCode == 13) {
                        checkPIN();
                    }
                });
                $(this).closest('.ui-dialog').find('.ui-dialog-titlebar-close').hide();
            },                
            buttons: {
                'OK': checkPIN
            }
        })
    </script>
</body>
</html>
